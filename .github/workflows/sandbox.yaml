name: ⚙️ Sandbox
on:
  push:
    branches: ['main']
  workflow_dispatch:
    inputs:
      env:
        description: 'Environment'
        default: 'TEST'

jobs:
  deployment-example:
    runs-on: ubuntu-latest
    environment: Playground
    steps:
      - uses: qoomon/actions--context@main
        id: context
      - run: echo Deploy...
    outputs:
      deploymentId: ${{ steps.context.outputs.deployment_id }}
  
  deployment-example-delete-deployment:
    needs: deployment-example
    runs-on: ubuntu-latest
    steps:
      - name: Delete Previous deployments
        uses: actions/github-script@v6
        env:
          DEPLOYMENT_ID: ${{ needs.deployment-example.outputs.deploymentId }}
        with:
          script: |
            const deploymentId = Number(process.env.DEPLOYMENT_ID);
            console.log('deploymentId:', deploymentId);
            await github.rest.repos.createDeploymentStatus({ 
              ...context.repo,
              deployment_id: deploymentId, 
              state: 'inactive',
            });
            await github.rest.repos.deleteDeployment({
              ...context.repo,
              deployment_id: deploymentId,
            });
  
